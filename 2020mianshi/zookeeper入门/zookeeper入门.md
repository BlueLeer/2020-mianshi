# Zookeeper

Zookeeperåœ¨æˆ‘ä½¿ç”¨dubboxï¼ˆå‰èº«æ˜¯é˜¿é‡Œå·´å·´çš„Dubbï¼‰å…¥é—¨çš„æ—¶å€™æ¥è§¦è¿‡ï¼Œå½“æ—¶ä¹Ÿæ˜¯çŸ¥é“å®ƒå¿…é¡»å’ŒDubboé…åˆèµ·æ¥ä½¿ç”¨ï¼Œä½œä¸ºDubboçš„æ³¨å†Œä¸­å¿ƒã€‚

Zookeeperæ˜¯Apache Hadoopçš„å­é¡¹ç›®ï¼Œåé¢æˆä¸ºäº†Apacheçš„é¡¶çº§é¡¹ç›®ã€‚Zookeeperæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼åº”ç”¨åè°ƒæœåŠ¡å™¨ï¼Œå…¶ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿæä¾›ä¸€è‡´æ€§æœåŠ¡ã€‚å®ƒä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼šé…ç½®ç»´æŠ¤ã€åˆ†å¸ƒå¼åŒæ­¥ã€é›†ç¾¤ç®¡ç†ã€åˆ†å¸ƒå¼äº‹åŠ¡ç­‰ç­‰ã€‚

ä½¿ç”¨åˆ†å¸ƒå¼ç³»ç»Ÿå°±æ— æ³•é¿å…å¯¹èŠ‚ç‚¹çš„ç®¡ç†é—®é¢˜ï¼Œå®ƒéœ€è¦å®æ—¶çš„æ„ŸçŸ¥å„ä¸ªå­ç³»ç»Ÿï¼ˆå­èŠ‚ç‚¹ï¼‰çš„çŠ¶æ€ï¼Œå¯¹èŠ‚ç‚¹è¿›è¡Œç»Ÿä¸€ç®¡ç†ç­‰ç­‰ã€‚Zookeeperæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼åº”ç”¨åè°ƒæœåŠ¡å™¨ï¼Œä½¿ç”¨å®ƒä»¥åï¼Œè§£å†³äº†åˆ†å¸ƒå¼ç³»ç»Ÿå¤§å¤æ‚æ€§é—®é¢˜ã€‚



## Zookeeperæ•°æ®å­˜å‚¨ç»“æ„

zookeeperæ•°æ®å­˜å‚¨ç»“æ„ä¸æ ‡å‡†çš„Unixæ–‡ä»¶ç³»ç»Ÿéå¸¸ç±»ä¼¼ï¼Œéƒ½æ˜¯åœ¨æ ¹èŠ‚ç‚¹ä¸‹é¢æŒ‚å¾ˆå¤šå­ç›®å½•ï¼Œè¿™æ ·ä¸€å±‚ä¸€å±‚çš„ï¼Œå½¢æˆäº†ä¸€ä¸ªæ ‘å½¢ç»“æ„ã€‚åªæ˜¯åšäº†ä¸€ä¸ªç±»æ¯”ï¼Œä½†æ˜¯zookeeperä¸­æ²¡æœ‰æ–‡ä»¶ç³»ç»Ÿä¸­çš„ç›®å½•å’Œæ–‡ä»¶çš„æ¦‚å¿µï¼Œè€Œæ˜¯ä½¿ç”¨äº†znodeä½œä¸ºæ•°æ®èŠ‚ç‚¹ã€‚znodeæ˜¯zookeeperä¸­çš„æœ€å°æ•°æ®å•å…ƒï¼Œæ¯ä¸ªznodeä¸Šéƒ½å¯ä»¥ä¿å­˜æ•°æ®ï¼ŒåŒæ—¶è¿˜å¯ä»¥æŒ‚åœ¨å­èŠ‚ç‚¹ï¼Œå½¢æˆäº†ä¸€ä¸ªæ ‘å½¢çš„å‘½åç©ºé—´ã€‚

![](zookeeperä¸­çš„æ•°æ®ç»“æ„.png)

æ¯ä¸ª`znode`éƒ½æœ‰è‡ªå·±æ‰€å±çš„**èŠ‚ç‚¹ç±»å‹**å’Œ**èŠ‚ç‚¹çŠ¶æ€**ã€‚

å…¶ä¸­**èŠ‚ç‚¹ç±»å‹**å¯ä»¥åˆ†ä¸º**æŒä¹…èŠ‚ç‚¹ã€æŒä¹…é¡ºåºèŠ‚ç‚¹ã€ä¸´æ—¶èŠ‚ç‚¹å’Œä¸´æ—¶é¡ºåºèŠ‚ç‚¹**ã€‚

* æŒä¹…èŠ‚ç‚¹

  ä¸€æ—¦åˆ›å»ºå°±ä¸€ç›´å­˜åœ¨ï¼Œç›´åˆ°å°†å…¶åˆ é™¤

* æŒä¹…é¡ºåºèŠ‚ç‚¹

  ä¸€ä¸ªçˆ¶èŠ‚ç‚¹å¯ä»¥ä¸ºå…¶å­èŠ‚ç‚¹**ç»´æŠ¤ä¸€ä¸ªåˆ›å»ºçš„å…ˆåé¡ºåº**ï¼Œè¿™ä¸ªé¡ºåºä½“ç°åœ¨**èŠ‚ç‚¹åç§°**ä¸Šï¼Œæ˜¯èŠ‚ç‚¹åç§°åè‡ªåŠ¨æ·»åŠ ä¸€ä¸ªç”±10ä½æ•°å­—ç»„æˆçš„æ•°å­—ä¸²ï¼Œä»0å¼€å§‹è®¡æ•°ã€‚ä¾‹å¦‚ï¼ˆnode-a-0000000000ï¼Œnode-b-0000000001ï¼‰

* ä¸´æ—¶èŠ‚ç‚¹

  ä¸´æ—¶èŠ‚ç‚¹çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸å®¢æˆ·ç«¯ä¼šè¯ç»‘å®šçš„ï¼Œä¼šè¯æ¶ˆå¤±åˆ™èŠ‚ç‚¹æ¶ˆå¤±ã€‚**ä¸´æ—¶èŠ‚ç‚¹åªèƒ½åˆ›å»ºå¶å­èŠ‚ç‚¹ï¼Œä¸èƒ½åˆ›å»ºå­èŠ‚ç‚¹ã€‚**

* ä¸´æ—¶é¡ºåºèŠ‚ç‚¹

  çˆ¶èŠ‚ç‚¹å¯ä»¥åˆ›å»ºä¸€ä¸ªç»´æŒäº†é¡ºåºçš„ä¸´æ—¶èŠ‚ç‚¹ï¼ˆå’ŒæŒä¹…é¡ºåºèŠ‚ç‚¹å‘½åä¸€è‡´ï¼‰

èŠ‚ç‚¹çŠ¶æ€ä¸­åŒ…å«äº†å¾ˆå¤šèŠ‚ç‚¹çš„å±æ€§ï¼Œæ¯”å¦‚czxidã€mzxidç­‰ç­‰ï¼Œåœ¨zookeeperä¸­æ˜¯ä½¿ç”¨Statè¿™ä¸ªç±»æ¥ç»´æŠ¤çš„ã€‚ä¸‹é¢é›·å‰§ä¸€äº›å±æ€§è§£é‡Šï¼š

* czxidï¼šCreated ZXIDï¼Œè¯¥æ•°æ®èŠ‚ç‚¹è¢«åˆ›å»ºæ—¶çš„äº‹åŠ¡IDã€‚
* mzxidï¼šModified ZXIDï¼ŒèŠ‚ç‚¹æœ€åä¸€æ¬¡è¢«æ›´æ–°æ—¶çš„äº‹åŠ¡IDã€‚
* ctimeï¼šCreate Timeï¼Œè¯¥èŠ‚ç‚¹è¢«åˆ›å»ºçš„æ—¶é—´ã€‚
* mtimeï¼šModified Timeï¼Œè¯¥èŠ‚ç‚¹æœ€åä¸€æ¬¡è¢«ä¿®æ”¹æ—¶çš„æ—¶é—´ã€‚
* versionï¼šèŠ‚ç‚¹çš„ç‰ˆæœ¬å·ã€‚
* cversionï¼š**å­èŠ‚ç‚¹**çš„ç‰ˆæœ¬å·
* aversionï¼šèŠ‚ç‚¹çš„`ACL` ç‰ˆæœ¬å·ã€‚
* ephemeralOwnerï¼šåˆ›å»ºè¯¥èŠ‚ç‚¹çš„ä¼šè¯çš„SessionIDï¼Œå¦‚æœè¯¥èŠ‚ç‚¹ä¸ºæŒä¹…èŠ‚ç‚¹ï¼Œè¯¥å€¼ä¸º0ã€‚
* dataLengthï¼šèŠ‚ç‚¹æ•°æ®å†…å®¹çš„é•¿åº¦ã€‚
* numChildrenï¼šè¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„ä¸ªæ•°ï¼Œå¦‚æœè¯¥èŠ‚ç‚¹ä¸ºä¸´æ—¶èŠ‚ç‚¹åˆ™ä¸º0ã€‚
* pzxidï¼šè¯¥èŠ‚ç‚¹å­èŠ‚ç‚¹åˆ—è¡¨æœ€åä¸€æ¬¡è¢«ä¿®æ”¹æ—¶çš„äº‹åŠ¡IDï¼Œæ³¨æ„æ˜¯å­èŠ‚ç‚¹çš„åˆ—è¡¨ï¼Œä¸æ˜¯å†…å®¹ã€‚



## Zookeeperä¼šè¯

zookeeperä¹Ÿæ˜¯c/sæ¶æ„ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ˜¯é€šè¿‡TCPé•¿è¿æ¥ç»´æŒä¼šè¯æœºåˆ¶ï¼Œå…¶å®å¯¹äºä¼šè¯æ¥è¯´ä½ å¯ç†è§£ä¸ºä¿æŒè¿æ¥çŠ¶æ€ã€‚

åœ¨zookeeperä¸­ï¼Œä¼šè¯è¿˜æœ‰å¯¹åº”çš„äº‹ä»¶ï¼Œæ¯”å¦‚`CONNECTION_LOSSè¿æ¥ä¸¢å¤±äº‹ä»¶`ã€`SESSION_MOVEDä¼šè¯è½¬ç§»äº‹ä»¶`ã€`SESSION_EXPIREDä¼šè¯è¶…æ—¶å¤±æ•ˆäº‹ä»¶`ã€‚



## ACL

ACLä¸ºAccess Control Listsï¼Œå®ƒæ˜¯ä¸€ç§æƒé™æ§åˆ¶ã€‚åœ¨zookeeperä¸­å®šä¹‰äº†5ç§æƒé™ï¼Œå®ƒä»¬åˆ†åˆ«ä¸ºï¼š

* CREATE åˆ›å»ºå­èŠ‚ç‚¹çš„æƒé™
* READ è·å–èŠ‚ç‚¹æ•°æ®å’Œå­èŠ‚ç‚¹åˆ—è¡¨çš„æƒé™
* WRITE æ›´æ–°èŠ‚ç‚¹æ•°æ®çš„æƒé™
* DELETE åˆ é™¤å­èŠ‚ç‚¹çš„æƒé™
* ADMIN è®¾ç½®èŠ‚ç‚¹ACLçš„æƒé™ï¼Œå¯ä»¥ç†è§£ä¸ºè¶…çº§ç®¡ç†å‘˜æƒé™



## Watcheræœºåˆ¶

Watcherä¸ºäº‹ä»¶ç›‘å¬å™¨ï¼Œæ˜¯zookeeperéå¸¸é‡è¦çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå¾ˆå¤šåŠŸèƒ½éƒ½ä¾èµ–äºå®ƒï¼Œå®ƒæœ‰ç‚¹å„¿ç±»ä¼¼äºè®¢é˜…çš„æ–¹å¼ï¼Œå³å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯æ³¨å†ŒæŒ‡å®šçš„watcherï¼Œå½“æœåŠ¡ç«¯å‡ºç°äº†ç›¸åº”çš„äº‹ä»¶ä»¥åï¼ŒæœåŠ¡ç«¯ä¼šå‘å®¢æˆ·ç«¯å‘é€äº‹ä»¶é€šçŸ¥ï¼Œç„¶åå®¢æˆ·ç«¯æ”¶åˆ°é€šçŸ¥ä»¥åï¼Œæ‰§è¡Œç›¸åº”çš„å›è°ƒé€»è¾‘ã€‚

å¸¸è§çš„ç›‘å¬åœºæ™¯æœ‰ä»¥ä¸‹ä¸¤ä¸ªï¼š

1. ç›‘å¬zookeeperèŠ‚ç‚¹æ•°æ®çš„å˜åŒ–
2. ç›‘å¬å­èŠ‚ç‚¹çš„å¢å‡å˜åŒ–



æ­£æ˜¯ç”±äºzookeeperçš„ `znodeï¼ˆä¸´æ—¶+æ°¸ä¹…ï¼‰+ç›‘å¬` å°±å¯ä»¥ç©å‡ºå¥½å¤šèŠ±æ ·äº†ã€‚



## Zookeeperå…¸å‹åº”ç”¨åœºæ™¯

### 1. é€‰ä¸»ï¼ˆMasteré€‰ä¸¾ï¼‰

è¿˜è®°å¾—ä¸Šé¢æˆ‘ä»¬çš„æ‰€è¯´çš„ä¸´æ—¶èŠ‚ç‚¹å—ï¼Ÿå› ä¸º `Zookeeper` çš„å¼ºä¸€è‡´æ€§ï¼Œèƒ½å¤Ÿå¾ˆå¥½åœ°åœ¨ä¿è¯ **åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ä¿è¯èŠ‚ç‚¹åˆ›å»ºçš„å…¨å±€å”¯ä¸€æ€§** (å³æ— æ³•é‡å¤åˆ›å»ºåŒæ ·çš„èŠ‚ç‚¹)ã€‚

åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ **è®©å¤šä¸ªå®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªæŒ‡å®šçš„èŠ‚ç‚¹** ï¼Œåˆ›å»ºæˆåŠŸçš„å°±æ˜¯ `master`ã€‚

ä½†æ˜¯ï¼Œå¦‚æœè¿™ä¸ª `master` æŒ‚äº†æ€ä¹ˆåŠï¼Ÿï¼Ÿï¼Ÿ

ä½ æƒ³æƒ³ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹ï¼Ÿè¿˜è®°å¾—ä¸´æ—¶èŠ‚ç‚¹çš„ç”Ÿå‘½å‘¨æœŸå—ï¼Ÿ`master` æŒ‚äº†æ˜¯ä¸æ˜¯ä»£è¡¨ä¼šè¯æ–­äº†ï¼Ÿä¼šè¯æ–­äº†æ˜¯ä¸æ˜¯æ„å‘³ç€è¿™ä¸ªèŠ‚ç‚¹æ²¡äº†ï¼Ÿè¿˜è®°å¾— `watcher` å—ï¼Ÿæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥ **è®©å…¶ä»–ä¸æ˜¯ master çš„èŠ‚ç‚¹ç›‘å¬èŠ‚ç‚¹çš„çŠ¶æ€** ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬ç›‘å¬è¿™ä¸ªä¸´æ—¶èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼Œå¦‚æœå­èŠ‚ç‚¹ä¸ªæ•°å˜äº†å°±ä»£è¡¨ `master` æŒ‚äº†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬ **è§¦å‘å›è°ƒå‡½æ•°è¿›è¡Œé‡æ–°é€‰ä¸¾** ï¼Œæˆ–è€…æˆ‘ä»¬ç›´æ¥ç›‘å¬èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡èŠ‚ç‚¹æ˜¯å¦å·²ç»å¤±å»è¿æ¥æ¥åˆ¤æ–­ `master` æ˜¯å¦æŒ‚äº†ç­‰ç­‰ã€‚

 ![](masteré€‰ä¸¾.png)

æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å®Œå…¨åˆ©ç”¨ **ä¸´æ—¶èŠ‚ç‚¹**ã€**èŠ‚ç‚¹çŠ¶æ€**å’Œ**watcher**æ¥å®ç°**masteré€‰ä¸¾**çš„åŠŸèƒ½ï¼Œä¸´æ—¶èŠ‚ç‚¹ä¸»è¦ç”¨æ¥æ ‡è®°é‚£ä¸ªæ˜¯ä¸»ï¼ŒèŠ‚ç‚¹çŠ¶æ€å’Œwatcherå¯ä»¥ç”¨æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦é‡æ–°é€‰ä¸¾ã€‚



### 2.åˆ†å¸ƒå¼é”

åˆ†å¸ƒå¼é”çš„å®ç°æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚Redisã€æ•°æ®åº“ã€zookeeperç­‰ç­‰ã€‚

> rediså®ç°åˆ†å¸ƒå¼é”ï¼Œå‚è€ƒï¼š<https://juejin.im/post/59edeb18f265da430a4fc076> ã€<https://blog.csdn.net/varyall/article/details/88751345> 



#### 2.1 äº’æ–¥é”ï¼ˆç‹¬å é”ï¼‰

zookeeperåœ¨é«˜å¹¶å‘æƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿä¿è¯èŠ‚ç‚¹åˆ›å»ºå…¨å±€å”¯ä¸€æ€§ï¼Œåˆ©ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œå¾ˆå¤šå®¢æˆ·ç«¯éƒ½å»åˆ›å»ºåŒä¸€èŠ‚ç‚¹ï¼Œä½†æ˜¯æœ€ç»ˆåªæœ‰ä¸€ä¸ªèƒ½å¤Ÿåˆ›å»ºæˆåŠŸï¼Œé‚£ä¹ˆåˆ›å»ºæˆåŠŸä¸å¦æ˜¯äº’æ–¥çš„ã€‚å› æ­¤å°±å¯ä»¥å®ç°äº’æ–¥é”äº†ï¼Œä¹Ÿå°±æ˜¯åˆ†å¸ƒå¼é”äº†ã€‚

åˆ†å¸ƒå¼æƒ…å†µä¸‹ï¼Œå¦‚ä½•è·å–é”å‘¢ï¼Ÿå› ä¸ºåˆ›å»ºèŠ‚ç‚¹çš„å”¯ä¸€æ€§ï¼Œæˆ‘ä»¬å¯ä»¥è®©å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶åˆ›å»ºä¸€ä¸ª**ä¸´æ—¶èŠ‚ç‚¹**ï¼Œåˆ›å»ºæˆåŠŸçš„å°±è¯´æ˜å®ƒè·å¾—äº†é”ã€‚æ²¡æœ‰åˆ›å»ºæˆåŠŸçš„å®¢æˆ·ç«¯ä¹Ÿåƒä¸Šé¢masteré€‰ä¸¾ä¸€æ ·åˆ›å»ºä¸€ä¸ª`watcher`è¿›è¡ŒèŠ‚ç‚¹çŠ¶æ€ç›‘å¬ï¼Œå¦‚æœè¿™ä¸ªäº’æ–¥é”è¢«é‡Šæ”¾äº†ï¼ˆå¯èƒ½æ˜¯å®¢æˆ·ç«¯ä¸»åŠ¨é‡Šæ”¾äº†é”ï¼›æˆ–è€…æ˜¯å®¢æˆ·ç«¯å®•æœºäº†å¯¼è‡´é”è¢«é‡Šæ”¾äº†ï¼Œä»€ä¹ˆï¼Ÿå®•æœºæ€ä¹ˆä¹Ÿå¯ä»¥é‡Šæ”¾é”å‘¢ï¼Ÿä¸Šé¢æåˆ°è¿‡ï¼Œä¸´æ—¶é”ç”Ÿå‘½å‘¨æœŸå’Œå®¢æˆ·ç«¯ä¼šè¯ç»‘å®šçš„ï¼Œå®•æœºä»¥åä¼šè¯è‚¯å®šæ²¡äº†ï¼Œè‚¯å®šä¹Ÿæ¶ˆå¤±äº†ï¼‰ï¼Œç„¶åè°ƒç”¨å›è°ƒå‡½æ•°é‡æ–°å‚ä¸é”çš„è·å–ã€‚

**zookeeperä¸­ä¸éœ€è¦åƒredisé‚£æ ·è€ƒè™‘å¦‚æœå æœ‰é”çš„å®¢æˆ·ç«¯æŒ‚äº†å¾—ä¸åˆ°é”çš„é—®é¢˜ï¼Œå› ä¸ºå½“å®¢æˆ·ç«¯æŒ‚äº†ï¼ŒèŠ‚ç‚¹ä¹ŸæŒ‚äº†ï¼Œé”ä¹Ÿé‡Šæ”¾äº†ã€‚** 

> å¯èƒ½æœ‰çš„åœ°æ–¹è¯´å°†ä¸Šé¢çš„**ä¸´æ—¶èŠ‚ç‚¹**æ¢æˆ**ä¸´æ—¶é¡ºåºèŠ‚ç‚¹**ã€‚Aã€Bã€Cä¸‰ä¸ªç³»ç»Ÿéƒ½å»è®¿é—® `/lock`èŠ‚ç‚¹ï¼Œè®¿é—®çš„æ—¶å€™ä¼šåˆ›å»ºå¸¦æœ‰é¡ºåºå·çš„**ä¸´æ—¶é¡ºåºèŠ‚ç‚¹**ï¼Œæ¯”å¦‚ç³»ç»ŸAåˆ›å»ºäº†`lock_0000000000`èŠ‚ç‚¹ï¼Œç³»ç»ŸBåˆ›å»ºäº†`lock_0000000001`èŠ‚ç‚¹ï¼Œç³»ç»ŸCåˆ›å»ºäº†`lock_0000000002`èŠ‚ç‚¹ã€‚å¦‚å›¾æ‰€ç¤ºï¼š
>
> ![](zookeeperåˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹å®ç°åˆ†å¸ƒå¼é”.png)
>
> æ¥ç€lockèŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰èŠ‚ç‚¹é€šè¿‡æ¯”å¯¹ï¼Œ**åˆ¤æ–­è‡ªå·±æ˜¯ä¸æ˜¯é¡ºåºå·æœ€å°çš„èŠ‚ç‚¹**ï¼š
>
> * å¦‚æœæ˜¯ï¼Œå¾—åˆ°é”
>
>   æ‰§è¡Œå®Œä»¥å ï¼Œå°†è‡ªå·±åˆ›å»ºçš„èŠ‚ç‚¹åˆ é™¤æ‰
>
> * å¦‚æœä¸æ˜¯ï¼Œç›‘å¬é¡ºåºå·æ¯”è‡ªå·±å°1çš„èŠ‚ç‚¹
>
> ä¸¾ä¸ªä¾‹å­ï¼š
>
> 1. ç³»ç»ŸAæ‹¿åˆ°/lockèŠ‚ç‚¹ä¸‹æ‰€æœ‰çš„å­èŠ‚ç‚¹ï¼Œæ¯”å¯¹é¡ºåºå·å‘ç°è‡ªå·±æ˜¯æœ€å°çš„ï¼Œæ‰€ä»¥å¾—åˆ°é”
> 2. ç³»ç»ŸBæ‹¿åˆ°/lockèŠ‚ç‚¹ä¸‹æ‰€æœ‰çš„å­èŠ‚ç‚¹ï¼Œæ¯”å¯¹é¡ºåºå·ä»¥åï¼Œå‘ç°æ¯”è‡ªå·±å°çš„æ˜¯id_000000èŠ‚ç‚¹ï¼Œç„¶åå°±å»ç›‘å¬æ¯”è‡ªå·±å°1çš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯AèŠ‚ç‚¹
> 3. ç³»ç»ŸCå¦‚æ˜¯...
> 4. ç³»ç»ŸAæ‰§è¡Œå®Œè‡ªå·±çš„é€»è¾‘ä¹‹åï¼Œåˆ é™¤äº†id_000000èŠ‚ç‚¹ï¼Œå› ä¸ºBç³»ç»Ÿç›‘å¬äº†id_000000èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œå½“æ”¶åˆ°id_000000èŠ‚ç‚¹å·²ç»åˆ é™¤çš„é€šçŸ¥ï¼ˆè¯¥é€šçŸ¥åªä¼šé€šçŸ¥Bç³»ç»Ÿï¼‰ä»¥åï¼Œå‘ç°è‡ªå·±æ˜¯æœ€å°çš„èŠ‚ç‚¹äº†ï¼Œäºæ˜¯é¡ºåˆ©çš„æ‹¿åˆ°é”äº†ã€‚
>
> æˆ‘è§‰å¾—è¿™ç§åˆ›å»ºå¸¦é¡ºåºå·çš„èŠ‚ç‚¹çš„æ–¹æ¡ˆè¦å¥½ä¸€äº›ï¼Œå®ƒé¿å…äº†ç¾Šç¾¤æ•ˆåº”ï¼ˆid_000000èŠ‚ç‚¹åˆ é™¤ä»¥åï¼Œid_000001ã€id_000002èŠ‚ç‚¹éƒ½æ”¶åˆ°äº†é€šçŸ¥ï¼Œå¦‚æœåŒæ—¶æœ‰æˆç™¾ä¸Šåƒä¸ªå®¢æˆ·ç«¯éƒ½åŒæ—¶ç›‘å¬id_000000èŠ‚ç‚¹ï¼Œå°±ä¼šå¯¼è‡´å¤§é‡ä¸å¿…è¦çš„é€šçŸ¥è¢«å‘å‡ºï¼Œä¸¥é‡å½±å“ç³»ç»Ÿçš„æ€§èƒ½ï¼‰ã€‚



#### 2.2 å¦‚ä½•åŒæ—¶å®ç°å…±äº«é”å’Œç‹¬å é”

è¿™ä¸ªæ—¶å€™å¿…é¡»ä¿è¯åˆ›å»ºçš„èŠ‚ç‚¹æ˜¯ **é¡ºåºä¸´æ—¶èŠ‚ç‚¹**ã€‚

å½“æ˜¯è¯»è¯·æ±‚ï¼ˆè¦è·å–å…±äº«é”ï¼‰çš„è¯ï¼Œå¦‚æœæ²¡æœ‰æ¯”è‡ªå·±æ›´å°çš„å†™è¯·æ±‚èŠ‚ç‚¹ï¼ˆè¦è·å–ç‹¬å é”ï¼‰ï¼Œåˆ™å¯ä»¥é¡ºåˆ©çš„è·å–è¯»é”ï¼Œç„¶åå¯ä»¥æ­£å¸¸å¯¹æ•°æ®è¿›è¡Œè¯»æ“ä½œäº†ã€‚è‹¥æ¯”è‡ªå·±å°çš„èŠ‚ç‚¹ä¸­æœ‰å†™è¯·æ±‚çš„æ—¶å€™ï¼Œåˆ™æ— æ³•è·å–è¯»é”ï¼Œåªèƒ½ç­‰åˆ°æ¯”è‡ªå·±å°çš„å†™è¯·æ±‚çš„èŠ‚ç‚¹æ‰§è¡Œå®Œé‡Šæ”¾é”ä»¥åæ‰èƒ½é¡ºåˆ©çš„æ‹¿åˆ°é”ã€‚

å½“æ—¶å†™è¯·æ±‚ï¼ˆè¦è·å–ç‹¬å é”ï¼‰çš„è¯ï¼Œå¦‚æœæ²¡æœ‰æ¯”è‡ªå·±æ›´å°çš„è¯·æ±‚èŠ‚ç‚¹ï¼ˆè¯»æˆ–è€…å†™è¯·æ±‚èŠ‚ç‚¹ï¼‰ï¼Œåˆ™ç›´æ¥è·å–åˆ°å†™é”ï¼ˆç‹¬å é”ï¼‰ã€‚è‹¥å‘ç°æœ‰æ¯”è‡ªå·±æ›´å°çš„èŠ‚ç‚¹ï¼ˆè¯»æˆ–è€…å†™è¯·æ±‚èŠ‚ç‚¹ï¼‰ï¼Œå½“å‰å®¢æˆ·ç«¯éƒ½æ— æ³•è·å–åˆ°å†™é”ï¼Œå¿…é¡»è¦ç­‰åˆ°å‰é¢çš„æ“ä½œå®Œæˆä»¥åæ‰èƒ½è·å–åˆ°å†™é”ã€‚



æ›´å¤šä½¿ç”¨åœºæ™¯ï¼Œå‚è€ƒï¼š<https://www.zhihu.com/collection/496193531> 



## Zookeeperåœ¨å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„åº”ç”¨

1. dubbo

   zookeeperä½œä¸ºè¿œç¨‹æœåŠ¡è°ƒç”¨åˆ†å¸ƒå¼æ¡†æ¶dubboçš„æ³¨å†Œä¸­å¿ƒã€‚zookeeperå­˜å‚¨äº†æœåŠ¡åç§°å’Œipåœ°å€çš„å¯¹åº”å…³ç³»ï¼Œå®ƒé€šè¿‡å¿ƒè·³æœºåˆ¶æ¥æ£€æµ‹æŒ‚æ‰çš„æœºå™¨ï¼ˆå¦‚æœæœºå™¨æŒ‚æ‰äº†ï¼Œåˆ™zookeeperä¸Šçš„ä¸´æ—¶èŠ‚ç‚¹å°±ä¼šè¢«åˆ é™¤ï¼‰ï¼Œå¹¶å°†å…¶ä»æœåŠ¡åˆ—è¡¨ä¸­åˆ é™¤ã€‚Dubbo+Zookeeperçš„ç»„åˆæ”¯æŒé«˜å¹¶å‘ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯æ¨ªå‘æ‰©å±•å¾ˆå®¹æ˜“ï¼Œåœ¨ä¸æ›´æ”¹ä»£ç çš„æƒ…å†µä¸‹é€šè¿‡æ·»åŠ æœºå™¨æ¥æé«˜ååé‡ã€å¹¶å‘é‡ã€‚æ–°çš„æœºå™¨åœ¨zookeeperä¸Šæ³¨å†Œæˆä¸ºæœåŠ¡æä¾›è€…ï¼Œè‡ªç„¶æ”¯æŒæ›´å¤šçš„è®¿é—®äº†ã€‚

   ![](zookeeperå’Œdubboæ¶æ„ç¤ºæ„å›¾.jpg)

2. kafka

   kafkaç”¨zookeeperæ¥å­˜å‚¨å…ƒæ•°æ®ï¼ˆæè¿°æ•°æ®çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´kafkaç”¨zookeeperæ¥å­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯zookeeperä½¿ç”¨åœºæ™¯ä¸­çš„ï¼š**é…ç½®ç»´æŠ¤**ï¼‰ã€‚kafkaä¸­å¤§éƒ¨åˆ†ç»„ä»¶éƒ½åº”ç”¨äº†zookeeperã€‚

   1. Brokeræ³¨å†Œ 

      `/broker/ids/[0...N]`è®°å½•äº†æœåŠ¡å…¶åˆ—è¡¨è®°å½•ï¼Œè¿™ä¸ªä¸´æ—¶çš„èŠ‚ç‚¹æ•°æ®æ˜¯ipç«¯å£ä¹‹ç±»çš„ä¿¡æ¯ã€‚

   2. Topicæ³¨å†Œ

      `/broker/topics`è®°å½•äº†topicçš„åˆ†åŒºä¿¡æ¯å’ŒBrokerçš„å¯¹åº”å…³ç³»

      ```shell
      # 1.ç™»å½•zookeeperå®¹å™¨
      [root@VM_0_13_centos ~]# docker exec -it zookeeper /bin/bash
      root@3f74f16b91ee:/apache-zookeeper-3.5.6-bin# ls /
      apache-zookeeper-3.5.6-bin  boot  data	   dev			 etc   lib    logs   mnt  proc	run   srv  tmp	var
      bin			    conf  datalog  docker-entrypoint.sh  home  lib64  media  opt  root	sbin  sys  usr
      
      # 2.è¿›å…¥åˆ°binç›®å½•
      root@3f74f16b91ee:/apache-zookeeper-3.5.6-bin# cd bin/
      root@3f74f16b91ee:/apache-zookeeper-3.5.6-bin/bin# ls
      README.txt  zkCleanup.sh  zkCli.cmd  zkCli.sh  zkEnv.cmd  zkEnv.sh  zkServer-initialize.sh  zkServer.cmd  zkServer.sh  zkTxnLogToolkit.cmd  zkTxnLogToolkit.sh
      
      # 3.è¿è¡ŒzkCli.shè¿›å…¥zookeeperå®¢æˆ·ç«¯
      root@3f74f16b91ee:/apache-zookeeper-3.5.6-bin/bin# ./zkCli.sh
      Connecting to localhost:2181
      2020-02-24 12:16:16,923 [myid:] - INFO  [main:Environment@109] - Client environment:zookeeper.version=3.5.6-c11b7e26bc554b8523dc929761dd28808913f091, built on 10/08/2019 20:18 GMT
      2020-02-24 12:16:16,969 [myid:] - INFO  [main:Environment@109] - Client environment:host.name=3f74f16b91ee
      2020-02-24 12:16:16,973 [myid:] - INFO  [main:Environment@109] - Client environment:java.version=1.8.0_242
      2020-02-24 12:16:17,030 [myid:] - INFO  [main:Environment@109] - Client environment:java.vendor=Oracle Corporation
      2020-02-24 12:16:17,030 [myid:] - INFO  [main:Environment@109] - Client environment:java.home=/usr/local/openjdk-8
      ......
      
      # 4. æ¥ä¸‹æ¥å°±åƒæ“ä½œlinuxæ–‡ä»¶ç›®å½•ä¸€æ ·çš„æ“ä½œäº†
      [zk: localhost:2181(CONNECTED) 0] ls /
      [dubbo, kafka, zookeeper]
      [zk: localhost:2181(CONNECTED) 1] ls /kafka
      [admin, brokers, cluster, config, consumers, controller, controller_epoch, isr_change_notification, latest_producer_id_block, log_dir_event_notification]
      [zk: localhost:2181(CONNECTED) 2] ls /kafka/brokers
      [ids, seqid, topics]
      [zk: localhost:2181(CONNECTED) 4] ls /kafka/brokers/topics
      # å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„topic
      [__consumer_offsets, lee123, logCenter, logCenter_test, sun]
      [zk: localhost:2181(CONNECTED) 5] ls /kafka/brokers/topics/logCenter
      [partitions]
      # logCenterè¿™ä¸ªtopicä¸‹é¢ä¸€å…±æœ‰2ä¸ªpartitions(åˆ†åŒº)
      [zk: localhost:2181(CONNECTED) 6] ls /kafka/brokers/topics/logCenter/partitions
      [0, 1]
      [zk: localhost:2181(CONNECTED) 7] 
      
      # å½“å‰zookeeperç»´æŠ¤çš„kafkaä¸€å…±åªæœ‰ä¸€ä¸ªæœåŠ¡ç«¯æœºå™¨
      [zk: localhost:2181(CONNECTED) 12] ls /kafka/brokers/ids
      [0]
      
      # æ­¤æ—¶åœæ‰ kafkaå®¹å™¨
      [zk: localhost:2181(CONNECTED) 17] ls /kafka/brokers/ids
      []
      ```

      å½“æˆ‘æŠŠ kafkaæœåŠ¡å™¨åœæ‰ä»¥å,å‘ç°`ls /kafka/brokers/ids` æ‰§è¡Œä»¥å,æ˜¾ç¤ºä¸º`[]` .

   3. ç”Ÿäº§è€…è´Ÿè½½å‡è¡¡

      **æœåŠ¡æä¾›è€…** åœ¨ `zookeeper` ä¸­åˆ›å»ºä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹å¹¶ä¸”å°†è‡ªå·±çš„ `ipã€portã€è°ƒç”¨æ–¹å¼` å†™å…¥èŠ‚ç‚¹ï¼Œå½“ **æœåŠ¡æ¶ˆè´¹è€…** éœ€è¦è¿›è¡Œè°ƒç”¨çš„æ—¶å€™ä¼š **é€šè¿‡æ³¨å†Œä¸­å¿ƒæ‰¾åˆ°ç›¸åº”çš„æœåŠ¡çš„åœ°å€åˆ—è¡¨(IPç«¯å£ä»€ä¹ˆçš„)** ï¼Œå¹¶ç¼“å­˜åˆ°æœ¬åœ°(æ–¹ä¾¿ä»¥åè°ƒç”¨)ï¼Œå½“æ¶ˆè´¹è€…è°ƒç”¨æœåŠ¡æ—¶ï¼Œä¸ä¼šå†å»è¯·æ±‚æ³¨å†Œä¸­å¿ƒï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡è´Ÿè½½å‡è¡¡ç®—æ³•ä»åœ°å€åˆ—è¡¨ä¸­å–ä¸€ä¸ªæœåŠ¡æä¾›è€…çš„æœåŠ¡å™¨è°ƒç”¨æœåŠ¡ã€‚

   4. æ¶ˆæ¯æ¶ˆè´¹è¿›åº¦ Offset è®°å½• 

      æ¶ˆè´¹è€…å¯¹æŒ‡å®šæ¶ˆæ¯åˆ†åŒºè¿›è¡Œæ¶ˆæ¯æ¶ˆè´¹çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å®šæ—¶å°†åˆ†åŒºæ¶ˆæ¯çš„æ¶ˆè´¹è¿›åº¦ Offset è®°å½•åˆ° ZooKeeper ä¸Šï¼Œä»¥ä¾¿æ¶ˆè´¹è€…è¿›è¡Œé‡å¯æˆ–è€…å…¶ä»–æ¶ˆè´¹è€…é‡æ–°é˜¶æ®µè¯¥æ¶ˆæ¯åˆ†åŒºçš„æ¶ˆæ¯æ¶ˆè´¹åï¼Œèƒ½å¤Ÿä»ä¹‹å‰çš„è¿›åº¦å¼€å§‹ç»§ç»­ç³»æ¶ˆè´¹ 

3. Hadoop

   ä»Šåè¡¥å……ã€‚ã€‚ã€‚

4. Spark

   ä»Šåè¡¥å……ã€‚ã€‚ã€‚

5. ã€‚ã€‚ã€‚ã€‚



å‚è€ƒ:

1. [ğŸ”¥ğŸ”¥ğŸ”¥ä¸‡å­—å¸¦ä½ å…¥é—¨Zookeeper](https://juejin.im/post/5e184673f265da3df716d449 ) ä½œè€…ï¼šFrancisQ
2. [ä»€ä¹ˆæ˜¯ZooKeeperï¼Ÿ](https://mp.weixin.qq.com/s?__biz=MzI4Njg5MDA5NA==&mid=2247485115&idx=1&sn=5d269f40f820c82b460993669ca6242e&chksm=ebd747badca0ceac9953f82e08b1d1a49498ebd4af77ec5d628a0682bb9f0ac5ab347411f654&mpshare=1&scene=24&srcid=0221Oje7oert0ClVjjku5QOB&sharer_sharetime=1582294962714&sharer_shareid=dc8fc270d4895826988f6a2f3145b443&key=59a92d8c8d4313e957ab97356c98a09e28487f0c638567286c75da744a17622e0ca49b029c5bbfbe6c794c771a20f3d4af87bc95a652cca1df90003cbcaafbd6721631d2105ac0d44606e39b5f424429&ascene=14&uin=MjczMjY2MTk2MA%3D%3D&devicetype=Windows+10&version=62080079&lang=zh_CN&exportkey=A%2B6jQ6pHoHdYGcts7un7aho%3D&pass_ticket=sqHlWJCqhl94tL9VgJ7Ebb4cSzl05I1aTYLDH3e8QrRC0%2FNXIghd97AZPHOJGNGG ) ä½œè€…ï¼šJava3y
3. [ZooKeeper çš„åº”ç”¨åœºæ™¯](https://zhuanlan.zhihu.com/p/59669985 ) ä½œè€…ï¼šrunzhliu