# 浅谈微服务架构

## 1.服务架构的演变

随着互联网逐渐发展、壮大，服务端的架构也在不断变得更庞大、更复杂。

服务架构的演变过程大概分为以下几个阶段：

1. 单一应用架构

   服务端解决所有问题，从数据存储到MVC。应用规模比较小的时候可以采用这种架构。它是一台服务器，一个开发框架，一个数据库便构成了一个完整的应用。

   这一阶段主要的瓶颈是ORM，因为整体应用通常是对数据库CRUD操作的一个封装，所以性能最终取决于数据库、应用框架与数据库之间的连接部分。

2. 垂直应用架构

   当应用规模增大时，单一服务支撑整个应用就显得力不从心了，此时需要对服务进行拆分了。最常见的拆分是**前后端分离**，此时服务端专注于提供接口，可以将服务进一步拆解成几个不想关的部分独立垂直部署，而前端提供一个统一的入口（例如我做过的项目，将后端拆成三个模块：后台管理、客户管理、订单管理三个模块，这三个模块是独立部署在三台服务器上的；前端通过nginx反向代理三个服务端）。

   这一阶段的主要性能瓶颈是MVC，换句话说，页面组织和开发将会是整个项目中最耗时的一部分（在没有复杂业务的前提下）

3. 分布式服务架构

   当垂直应用越来越多时，就不可避免的产生交叉，此时的做法是将核心业务抽离出来，作为独立的服务中心部署。当一个应用依赖的服务数量可能已经是一个非常庞大的数字，这时，就必须对所有的这些服务进行必要的监控、调整以及整合。

   这一阶段的主要的性能瓶颈便是**分布式服务框架（RPC）**。

4. 流动计算架构

   服务越来越多时，容量的评估，小服务资源的浪费等问题便愈发严重，此时需要增加一个调度中心便于访问压力实时管理集群容量，提高集群利用率。

   这一阶段的主要性能瓶颈是资源调度和治理中心（SOA）。



## 2.分布式服务框架的关注点

针对大型应用编程的时候，设计的思路不再是面向服务器的一条龙式编程，而是面向服务的编程，这是一个重要的思维模式的转换。

开发人员的关注点也随之发生变化，在分布式服务框架中，我们需要关注的问题有以下几个：

1. 服务之间如何通信

   其实从分布式的架构中不难看出，服务之间的通信其实是分布式框架的一个重点。要实现服务之间的通信，现在业内主要使用以下几种方案：

   * 同步

     * 高性能RPC，比如Dubbo本身其实是一个RPC框架，重点在于实现对于外部服务过程的**透明调用**
     * RESTful API，通信基于JSON数据格式，比起RPC可能性能略低，但是规范、可复用性强

   * 异步

     使用消息队列，例如Kafka、RabbitMQ、RocketMA、ActiveMQ等等。

2. 客户端如何访问到服务

   当服务被拆分，部署到集群，客户端再也无法通过固定的地址来访问到服务。同时，服务真正部署的节点可能还会随时发生变动：删除、增加或者是故障，都需要客户端能够**实时感知**，为了实现这个效果，需要提供下面练个实现：

   * API Gateway：API网关，外界Client访问的一个统一入口，内部通过负载均衡等手段将客户端定向到真正的服务提供节点（例如）

3. 服务出现故障时怎么办

4. 数据如何共享









目前成熟的微服务解决方案

1. SpringBoot + SpringCloud
2. SpringBoot + Dubbo + Zookeeper

微服务架构有哪些问题？（需要面临4大问题，最后达到的效果是高可用，高并发，高性能）

1. 客户端如何访问那么多系统?

   * API网关

2. 服务和服务之间如何通信?

   * 同步通信

     * Http（Apache Http Client）
     * RPC（Dubbo，只支持Java，Apache Thrift）

   * 异步通信

     消息队列，例如：Kafka，RabbitMQ，RocketMQ

3. 这么多服务如何管理？

   服务治理

   - 服务注册与发现（能够感知服务的注册，上线，下线，是否可用等等）

     - 基于客户端的服务注册与发现

       Zookeeper

     - 基于服务端的服务注册与发现

       Eureka

4. 服务挂了怎么办？

   重试机制

   服务熔断

   服务降级

   服务限流
